cmake_minimum_required(VERSION 3.22)
project(acorn C)

option(test "Build all tests." OFF)


set(CMAKE_C_STANDARD 11)

#export LDFLAGS="-L/opt/homebrew/opt/llvm@12/lib"
#export CPPFLAGS="-I/opt/homebrew/opt/llvm@12/include"
link_directories(/opt/homebrew/opt/llvm@12/lib)

# Library
file(GLOB_RECURSE SOURCES src/*.c)
file(GLOB_RECURSE HEADERS include/*.h)
add_library(${PROJECT_NAME}_lib STATIC ${SOURCES} ${HEADERS})
target_include_directories(${PROJECT_NAME}_lib PUBLIC include)
target_include_directories(${PROJECT_NAME}_lib PUBLIC /opt/homebrew/opt/llvm@12/include)
target_link_libraries(${PROJECT_NAME}_lib PRIVATE LLVM)

# Executable
add_executable(${PROJECT_NAME} bin/main.c)
target_link_libraries(${PROJECT_NAME} ${PROJECT_NAME}_lib)

if (test)
add_subdirectory(test)
endif()

## Testing
#if (test)
#    if (APPLE)
#        add_definitions(-DGTEST_USE_OWN_TR1_TUPLE)
#        add_definitions(-D__GLIBCXX__)
#    endif (APPLE)
#
#    # Fetch GoogleTest
#    include(FetchContent)
#    FetchContent_Declare(
#            googletest
#            URL https://github.com/google/googletest/archive/5126f7166109666a9c0534021fb1a3038659494c.zip
#    )
#    set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
#    FetchContent_MakeAvailable(googletest)
#
#    enable_testing()
#
#    file(GLOB_RECURSE TEST_SOURCES test/**.cc)
#    add_executable(${PROJECT_NAME}_test ${TEST_SOURCES} ${SOURCES})
#    target_link_libraries(${PROJECT_NAME}_test gtest gtest_main)
#    target_include_directories(${PROJECT_NAME}_test PUBLIC include)
##    target_link_libraries(${PROJECT_NAME}_test ${PROJECT_NAME}_lib)
#
#
#
#    gtest_discover_tests(${PROJECT_NAME}_test)
#
#endif ()



